<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./css/style.css">
    <script src="./js/html2canvas.js"></script>
    <title>测试</title>
</head>

<body>
    <div class="index">
        <div class="canvas" ref="canvas">
            <div class="avatar">
                <img src="https://upload.jianshu.io/users/upload_avatars/5688440/df757d94-74f0-4862-a648-0258da84da58.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/120/h/120"
                    alt="">
            </div>
            <div class="text">
                <p>手气好，抽到宝，你不来试试吗？</p>
                <p>我刚刚抽到了：</p>
            </div>
            <div class="box">
                <div class="title">小米音乐音响</div>
                <div class="sound">
                    <img src="https://upload.jianshu.io/users/upload_avatars/5688440/df757d94-74f0-4862-a648-0258da84da58.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/120/h/120" alt="">
                </div>
                <div class="qrcode">
                    <img src="https://upload.jianshu.io/users/upload_avatars/5688440/df757d94-74f0-4862-a648-0258da84da58.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/120/h/120" alt="">
                </div>
                <div class="tip">长按识别 试试运气</div>
            </div>
            <div class="from">
                来自UU跑腿抽奖
            </div>
        </div>
        <div class="save_btn" @click="savecanvas">
            保存图片
        </div>
    </div>


    <script src="https://cdn.staticfile.org/vue/2.4.2/vue.min.js"></script>
    <script>
        var vue = new Vue({
            el: '.index',
            data: {

            },
            methods: {
                savecanvas() {
                    let canvas = document.querySelector('.canvas');
                    let that = this;
                    html2canvas(canvas, {
                        scale: 2,
                        logging: false,
                        useCORS: true
                    }).then(function (canvas) {
                        let type = 'png';
                        let imgData = canvas.toDataURL(type);
                        // 照片格式处理
                        let _fixType = function (type) {
                            type = type.toLowerCase().replace(/jpg/i, 'jpeg');
                            let r = type.match(/png|jpeg|bmp|gif/)[0];
                            return 'image/' + r;
                        };
                        imgData = imgData.replace(_fixType(type), 'image/octet-stream');
                        let filename = "UUSound" + '.' + type;
                        that.saveFile(imgData, filename);
                    });
                },
                saveFile(data, filename) {
                    let save_link = document.createElementNS('http://www.w3.org/1999/xhtml', 'a');
                    save_link.href = data;
                    save_link.download = filename;

                    let event = document.createEvent('MouseEvents');
                    event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false,
                        false, 0, null);
                    save_link.dispatchEvent(event);
                }
            },
        })
    </script>
</body>

</html>